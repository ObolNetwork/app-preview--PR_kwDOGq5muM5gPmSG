(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{84679:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm-configuration",function(){return t(19742)}])},98064:function(e,s,t){"use strict";t.d(s,{I:function(){return c}});var a=t(85893),r=t(28014),i=t(63029),n=t(62971);let l=[{accessorKey:"operator",header:"Address"},{accessorKey:"split",header:"Split",css:{width:"70px"}}],c=e=>{let{recipients:s,type:t,validatorsSize:c}=e,o=(0,i.Z)(s.map(e=>e.address));return"Principal & Rewards"===t?(0,a.jsx)(r.iA,{columns:[...l,{accessorKey:"principal",header:"Principal",css:{width:"70px"}}],rows:s.map((e,s)=>({operator:(0,a.jsx)(n.M,{ensName:o[s],address:e.address}),split:"".concat(e.split||e.percentAllocation," %"),principal:"".concat(Number(e.split||e.percentAllocation)/100*32*c)}))}):(0,a.jsx)(r.iA,{columns:l,rows:s.map((e,s)=>({operator:(0,a.jsx)(n.M,{ensName:o[s],address:e.address}),split:"".concat(e.split||e.percentAllocation," %")}))})}},19742:function(e,s,t){"use strict";t.r(s);var a=t(85893),r=t(67294),i=t(71866),n=t(64146),l=t(28014),c=t(3441),o=t(41518),d=t(87536),h=t(2504),p=t(21237),u=t(80050),x=t(11163),g=t(98064),m=t(37005),v=t(4010),f=t(23500),j=t(28106);let w=()=>{let e,s;let{account:t,provider:w,chainId:y}=(0,h.kR)(),{handleSubmit:S}=(0,d.cI)({mode:"onChange"}),A=(0,x.useRouter)(),[C,_]=(0,r.useState)(),[b,k]=(0,r.useState)(),[N,$]=(0,r.useState)(!1),[R,E]=(0,r.useState)(""),[I,O]=(0,r.useState)(),[W,D]=(0,r.useState)(),[T,K]=(0,r.useState)(!1),[P,F]=(0,r.useState)(""),H="v1.7.0",[M,z]=(0,r.useState)(!1),[Z,B]=(0,r.useState)(""),[L,X]=(0,r.useState)(""),Y=(0,o.o)(e=>e.clusterDefinition),J=(null==Y?void 0:Y.principal)&&!(null==Y?void 0:Y.singleAddress)&&(null==Y?void 0:Y.recipients.every(e=>(0,p.H6)(e))),Q=!(null==Y?void 0:Y.principal)&&!(null==Y?void 0:Y.singleAddress)&&(null==Y?void 0:Y.recipients.every(e=>(0,p.H6)(e))),U=!(null==Y?void 0:Y.principal)&&(null==Y?void 0:Y.singleAddress)&&!(null==Y?void 0:Y.recipients.every(e=>(0,p.H6)(e)));J?(e="Rewards",s="Deploy Optimistic Withdrawal Recipient Contract"):Q&&(e="Principal & Rewards",s="Deploy Splitter Contract");let q=null==Y?void 0:Y.operators.some(e=>e.address===t),V=(0,o.o)(e=>e.updateClusterDefinition),G=(0,o.o)(e=>e.completeLeaderStep),ee=(0,o.o)(e=>e.enableLeaderStep),es=()=>{_(null),k(null),E(""),O(""),D(""),$(!1)},et=e=>{console.log(e),es()},ea=async e=>{let s=await (0,u.c0)({token:e,data:C});if(!s.data.config_hash)throw"no config hash returned";E(s.data.config_hash)};(0,r.useEffect)(()=>{if(C){let e=async()=>{try{let e={creator_config_hash:C.config_hash},s=await (0,p.L6)(w,y,t,e);if(await ea(s),q){let e={operator_config_hash:C.config_hash},s=await (0,p.AM)(w,y,t,e);D(s);let a={enr:null==Y?void 0:Y.enr},r=await (0,p.Ol)(w,y,t,a);O(r)}}catch(e){et(e)}};e()}},[C]),(0,r.useEffect)(()=>{if(q&&b&&R||!q&&R){G("confirm-configuration");let e=ee("invite-group");$(!1),A.push({pathname:e.href,query:{configHash:R}})}},[b,R]),(0,r.useEffect)(()=>{if(q&&I&&W&&R){let e=async()=>{let e={address:t,enr:null==Y?void 0:Y.enr,enr_signature:I,fork_version:c.se,version:H},{data:s}=await (0,u.R)({token:W,data:e,configHash:R});k(s)};e().catch(et)}},[I,R]);let er=()=>(0,a.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(j.uo,{}),(0,a.jsx)(i.VL,{operators:[...null==Y?void 0:Y.operators],currentAccount:t})]})}),ei=()=>(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,a.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Your Charon client ENR"}),(0,a.jsx)(l.KZ,{content:'An ENR is an "Ethereum Node Record" used to identify your client to the other clients in the cluster"',children:(0,a.jsx)(l.xu,{css:{display:"flex"},children:(0,a.jsx)(l.by,{})})})]}),(0,a.jsx)(i.Kx,{css:{minHeight:"115px"},placeholder:"Your enr",value:null==Y?void 0:Y.enr,readOnly:!0})]}),(0,a.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/next/int/faq/errors#enrs-keys",target:"_blank",children:["More on Ethereum Node Records ",(0,a.jsx)(l.ZJ,{})]})]}),en=async e=>{let{recipientsAddresses:s,splitPercentages:t,splitMainContract:a}=e;try{let e=await (0,f.s8)(s,t,a);console.log("realSplitAddress",e),V({...Y,validators:Array(Y.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:e})}),F(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw console.log(e,"errorMessage"),B(e),s}},el=async e=>{let{recipientsAddresses:s,splitPercentages:t,predictedSplitAddress:a}=e;try{let{owrAddress:e,splitAddress:r}=await (0,f.KZ)({principalRecipient:Y.principal,amountOfPrincipalStake:32*Y.validatorsSize},{accounts:s,percentAllocations:t},a,w.getSigner(0));V({...Y,validators:Array(Y.validatorsSize).fill({feeRecipientAddress:r,withdrawalAddress:e})}),F(r);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw B(e),s}},ec=async e=>{try{let s=await (0,f.Sf)(Y.principal,e,32*Y.validatorsSize,w.getSigner(0));console.log(s,"OWRecipientContractAddresses"),V({...Y,validators:Array(Y.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:s})}),F(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw B(e),s}},eo=async e=>{if(e.preventDefault(),!T){K(!0);try{if(!(await (0,p.wB)(c.eq,w)&&await (0,p.wB)(c.tm,w)&&await (0,p.wB)(c.WF,w))){B(c.sD),K(!1);return}let e=[...Y.recipients];e.sort((e,s)=>e.address.localeCompare(s.address));let s=e.map(e=>e.address),t=e.map(e=>{let s=(1e4*parseFloat(e.split)).toFixed(0);return parseInt(s)}),a=new n.Contract(c.tm,v.Mt,null==w?void 0:w.getSigner(0)),r=await a.predictImmutableSplitAddress(s,t,c.Uu);console.log("predictedSplitAddress",r);let i=await (0,f.Kv)(r,y);console.log(i,"isSplitterDeployed"),J?i?(await ec(r),X(c.Oy)):await el({recipientsAddresses:s,splitPercentages:t,predictedSplitAddress:r}):Q&&(i?(V({...Y,validators:Array(Y.validatorsSize).fill({feeRecipientAddress:r,withdrawalAddress:r})}),F(r),X(c.Oy)):await en({recipientsAddresses:s,splitPercentages:t,splitMainContract:a})),K(!1)}catch(e){console.log(e,"errr"),K(!1)}}},ed=(0,r.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{}),(0,a.jsx)(j.XD,{}),q&&(0,a.jsx)(ei,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),"Rewards"===e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.nB,{heading:"Principal Address",description:"Address to receive validator principal and rewards at exit..",value:null==Y?void 0:Y.principal,className:"principal-address-section"}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:Y.recipients,type:e})]}),P&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Optimistic Withdrawal Recipient Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Optimistic Withdrawal Recipient Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:Y.validators[0].withdrawalAddress}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(Y.validators[0].withdrawalAddress,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]})]}),"Principal & Rewards"===e&&(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:Y.recipients,type:e,validatorsSize:Y.validators.length})]}),P&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Splitter Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Splitter Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:P}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(P,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]}),!P&&(0,a.jsx)(i.fl,{color:"primary",type:"button",onClick:eo,disabled:!!Z,children:(0,a.jsxs)(a.Fragment,{children:[T&&(0,a.jsx)(l.yC,{}),s]})}),L&&(0,a.jsx)(l.xv,{variant:"metadata",color:"testHover",children:L}),Z&&(0,a.jsx)(l.xv,{variant:"metadata",color:"test",children:Z})]})]}),[P,T,Z,Y]),eh=(0,r.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{}),(0,a.jsx)(j.XD,{}),q&&(0,a.jsx)(ei,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$lg"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),(0,a.jsx)(j.nB,{heading:"Principal Address",description:"The withdrawal address or contract will receive 100%.",value:null==Y?void 0:Y.singleAddress,className:"single-address-section"}),(0,a.jsx)(j.nB,{heading:"Fee Recipient Address",description:"Address to receive transaction fees from block proposals.",value:null==Y?void 0:Y.feeRecipientAddress,className:"fee-recipient-address-section"})]})]}),[Y]);if(!Y)return(0,a.jsx)(l.xv,{children:"No cluster data ..."});let ep=async()=>{if(N)return;console.log(JSON.stringify(Y),"currentClusterData");let e=(0,p.KH)(Y,H);console.log(e.config_hash,"config_hashconfig_hash"),_(e),$(!0)};return(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(l.xv,{variant:"h3",children:"Confirm Configuration"}),(0,a.jsx)(i.l0,{onSubmit:S(ep),children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(m.T,{name:"reward_split_withdrawal_flow",children:J&&ed}),(0,a.jsx)(m.T,{name:"split_withdrawal_flow",children:Q&&ed}),(0,a.jsx)(m.T,{name:"single_withdrawal_address_flow",children:U&&eh}),(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$lg"},children:(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"h4",children:"Confirm Details "})}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xl"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$xs",width:"$full"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.XZ,{checked:M,onCheckedChange:()=>z(!M)})}),(0,a.jsx)(l.xv,{variant:"body",children:"You will be prompted to sign a message with your wallet. This signature is attesting to the fact that:"})]}),(0,a.jsx)(l.sQ,{heading:"You have confirmed the withdrawal address for the validators to be created is correct. If this address is a contract, you have confirmed the contract implementation is correct. If this address is an externally-owned account, you have confirmed that the EOA custody is secure."}),(0,a.jsx)(l.sQ,{heading:"You have submitted your charon node's Ethereum Node Record (ENR) correctly. This signature is the authorisation of this charon client to act on your behalf."})]}),(0,a.jsx)(i.fl,{color:"primary",type:"submit",disabled:!U&&!P||!M,children:(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsx)(l.yC,{}),"Confirm and Sign"]})})]})})]})})]})};s.default=w,w.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=84679)}),_N_E=e.O()}]);